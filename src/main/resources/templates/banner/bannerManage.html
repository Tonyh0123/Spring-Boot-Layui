<!DOCTYPE html>
<html  xmlns:th="http://www.thymeleaf.org"
       xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head th:include="layout :: htmlhead" th:with="title='首页banner管理'"></head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
    <!--头-->
    <div th:replace="fragments/head :: header"></div>
    <a id="checkThat" style="display: none"><shiro:principal property="roleId"></shiro:principal></a>

    <div id="bannerListFather" class="layui-body" style="margin: 1%">

        <hr class="layui-bg-orange"/>

        <button class="layui-btn" onclick="openBannerInsert()">新增banner</button>

        <table id="bannerList" lay-filter="bannerTable"></table>

        <script type="text/html" id="optBar">
            <a class="layui-btn layui-btn-xs" lay-event="previewFile">查看banner</a>
            <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
        </script>
    </div>


    <!--添加或编辑首页banner-->
    <div id="addBanner" class="" style="display:none;">
        <form id="bannerForm" class="layui-form layui-form-pane " method="post" action="" style="margin-top: auto; margin-left: auto;">
            <input id="pageNum" type="hidden" name="pageNum"/>
            <input id="id" type="hidden" name="id"/>
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label "><b>图片a标签链接</b></label>
                <div class="layui-input-block">
                    <input id="hrefLink" name="hrefLink" lay-verify="required" autocomplete="off" class="layui-input" placeholder="图片a标签链接" type="text"/>
                </div>
            </div>
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label" ><b>图片路径</b></label>
                <div class="layui-input-block">
                    <input id="imgUrl" name="imgUrl" lay-verify="required" autocomplete="off" class="layui-input" placeholder="图片路径" type="text" readonly/>
                </div>
            </div>

            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label" ><b>图片提示信息</b></label>
                <div class="layui-input-block">
                    <input id="imgTitle" name="imgTitle" lay-verify="required" autocomplete="off" class="layui-input" placeholder="图片提示信息" type="text" />
                </div>
            </div>


            <div class="layui-form-item">
                <div class="layui-upload-button">
                    <button type="button" class="layui-btn" id="uploadButton">
                        <i class="layui-icon">&#xe67c;</i>上传图片
                    </button>

                    <button type="button" class="layui-btn" id="previewButton" style="display: none" onclick="pdfsee()">
                        <i class="layui-icon">&#xe67c;</i>预览图片
                    </button>

                </div>

            </div>
            <blockquote class="layui-elem-quote">为了确保首页banner效果显示正常，请确保banner图片分辨率为“1920*898”</blockquote>
            <div class="layui-form-item">
                <div class="layui-input-block" style="margin-left: 420px;">
                    <button class="layui-btn"  lay-submit="" lay-filter="bannerSubmit">提交</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
        </form>
    </div>


    <!--底部-->
    <div th:replace="fragments/footer :: footer"></div>
    <script src="/js/dateUtils.js"></script>
    <script src="/js/banner/bannerList.js"></script>
    <script>
        var pdf = "";
        layui.use(['form','table','upload','element'],function(){
            var upload = layui.upload;
            var element = layui.element;
            element.init();
            //执行实例
            upload.render({
                elem: '#uploadButton' //绑定元素
                ,url: '/upload/noticeFileUpload' //上传接口
                ,method: 'post'
                ,accept: 'file'
                ,progress: function(n, elem){
                    var percent = n + '%'; //获取进度百分比
                    element.progress('demo', percent); //可配合 layui 进度条元素使用
                    console.log(elem);
                }
                ,done: function(res){

                    document.getElementById("previewButton").style.display='';
                    pdf = res.fileUrl;
                    console.log(pdf);
                    $("#imgUrl").val(res.fileUrl);
                    $("#imgTitle").val(res.fileName);

                }
                ,error: function(){
                    alert("failed");
                    //请求异常回调
                }
            });
        });

        function pdfsee() {
            var uul = pdf;
            console.log(pdf);
            layui.use('layer', function () {
                var layer = layui.layer;
                layer.open({
                    type: 2,
                    area: ['1900px', '950px'],
                    fixed: false, //不固定
                    maxmin: true,
                    content: uul
                });
            });
        };

    </script>

</div>

</body>
</html>